<!DOCTYPE html>
<html lang="id">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Little - POS System</title>
    <link rel="stylesheet" href="./style.css?v=1.2">
    <link rel="stylesheet" href="./dark-theme.css?v=1.2">
    <link rel="manifest" href="./manifest.json">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@200;300;400;500;600;700&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#6366f1">
    <script>
        // Register Service Worker for PWA
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('./sw.js').catch(err => console.error('PWA Error:', err));
            });
        }

        // PWA Install Logic
        let deferredPrompt;
        window.addEventListener('beforeinstallprompt', (e) => {
            // e.preventDefault(); // Lepaskan ini agar Chrome bisa munculin bar otomatis
            deferredPrompt = e;
            const installBtn = document.getElementById('install-btn');
            if (installBtn) installBtn.style.display = 'flex';
        });

        async function installApp() {
            if (deferredPrompt) {
                deferredPrompt.prompt();
                const { outcome } = await deferredPrompt.userChoice;
                if (outcome === 'accepted') {
                    console.log('User accepted the install prompt');
                    document.getElementById('install-btn').style.display = 'none';
                }
                deferredPrompt = null;
            }
        }
    </script>
</head>

<body>
    <div id="app">
        <!-- Sidebar Navigation -->
        <aside class="sidebar">
            <div class="logo"
                style="flex-direction: column; align-items: center; text-align: center; gap: 12px; padding-bottom: 1.5rem;">
                <div class="logo-icon" style="width: 60px; height: 60px; margin-bottom: 5px;">
                    <i class="fa-solid fa-mug-hot" style="font-size: 1.8rem;"></i>
                </div>
                <div class="logo-info" style="align-items: center; gap: 2px;">
                    <h2 style="font-size: 1.4rem; font-weight: 800; color: var(--primary-dark); margin: 0;">LITTLE</h2>
                    <span
                        style="font-size: 0.75rem; color: var(--text-muted); text-transform: uppercase; letter-spacing: 1px;">Point
                        of Sale</span>
                </div>
            </div>

            <div class="header-controls"
                style="margin-top: 12px; display: flex; gap: 10px; justify-content: center; background: #f8f9fa; padding: 6px 12px; border-radius: 20px; border: 1px solid #eee;">
                <button id="lang-toggle" title="Ganti Bahasa (ID/EN)"
                    style="color: var(--text-muted); background: none; border: none; cursor: pointer;">
                    <i class="fa-solid fa-language"></i>
                </button>
                <button id="theme-toggle" title="Toggle Dark Mode"
                    style="color: var(--text-muted); background: none; border: none; cursor: pointer;">
                    <i class="fa-solid fa-moon"></i>
                </button>
                <div id="admin-toggle-btn" class="role-badge" title="Switch Role"
                    style="cursor: pointer; color: var(--text-muted);">
                    <i class="fa-solid fa-lock" id="admin-lock-icon"></i>
                </div>
            </div>

            <nav>
                <button class="nav-item active" data-category="all">
                    <i class="fa-solid fa-border-all"></i> <span data-i18n="nav_all">Semua Menu</span>
                </button>
                <button class="nav-item" data-category="signature">
                    <i class="fa-solid fa-star"></i> <span>Signature</span>
                </button>
                <button class="nav-item" data-category="coffee">
                    <i class="fa-solid fa-mug-hot"></i> <span>Coffee</span>
                </button>
                <button class="nav-item" data-category="non-coffee">
                    <i class="fa-solid fa-glass-water"></i> <span>Non-Coffee</span>
                </button>
                <button class="nav-item" data-category="tea">
                    <i class="fa-solid fa-leaf"></i> <span>Tea Series</span>
                </button>
                <button class="nav-item" data-category="snack">
                    <i class="fa-solid fa-burger"></i> <span>Snack</span>
                </button>
            </nav>
            <div class="sidebar-footer">
                <div style="position: relative;">
                    <button class="settings-btn" id="more-actions-trigger"
                        style="width: 100%; justify-content: center; font-weight: 600;">
                        <i class="fa-solid fa-sliders"></i> <span data-i18n="btn_manage">Kelola Toko</span>
                    </button>

                    <div id="more-actions-menu" class="action-menu hidden">
                        <button class="action-item admin-only hidden" id="add-product-btn-trigger">
                            <div class="icon-box"><i class="fa-solid fa-plus-circle"></i></div>
                            <span>Tambah Menu</span>
                        </button>
                        <button class="action-item admin-only hidden" id="history-btn">
                            <div class="icon-box"><i class="fa-solid fa-clock-rotate-left"></i></div>
                            <span>Riwayat</span>
                        </button>
                        <button class="action-item" id="btn-split-bill">
                            <div class="icon-box"><i class="fa-solid fa-calculator"></i></div>
                            <span>Split Bill</span>
                        </button>
                        <button class="action-item admin-only hidden" id="edit-mode-btn">
                            <div class="icon-box"><i class="fa-solid fa-pen-to-square"></i></div>
                            <span>Edit Menu</span>
                        </button>
                        <button class="action-item admin-only hidden" id="download-report-btn">
                            <div class="icon-box"><i class="fa-solid fa-file-csv"></i></div>
                            <span>Laporan (CSV)</span>
                        </button>
                    </div>
                </div>

                <div class="cashier-section" style="margin-top: 5px; border-top: 1px solid #eee; padding-top: 15px;">
                    <label
                        style="display:block; margin-bottom:0.5rem; color: var(--text-muted); font-size:0.8rem; font-weight: 500;"
                        data-i18n="lbl_cashier">Kasir
                        Aktif</label>
                    <div style="display: flex; gap: 5px;">
                        <select id="cashier-select" style="flex:1; padding: 0.5rem; border: 1px solid #ddd; 
                                 background: white; color: var(--text-main); border-radius: 4px; font-size: 0.9rem;">
                            <option value="">-- Pilih --</option>
                        </select>
                        <button id="add-cashier-btn"
                            style="background: var(--success); color: white; border: none; padding: 0 10px; border-radius: 4px; cursor: pointer;"
                            title="Tambah Kasir">
                            <i class="fa-solid fa-plus"></i>
                        </button>
                        <button id="delete-cashier-btn"
                            style="background: var(--error); color: white; border: none; padding: 0 10px; border-radius: 4px; cursor: pointer;"
                            title="Hapus Kasir">
                            <i class="fa-solid fa-trash"></i>
                        </button>
                    </div>
                </div>

                <!-- PWA Install Button -->
                <button id="install-btn" onclick="installApp()" class="settings-btn"
                    style="display: none; width: 100%; justify-content: center; background: var(--primary-color); color: white; margin-top: 10px; font-weight: 600;">
                    <i class="fa-solid fa-download"></i>
                    <span>Instal Aplikasi</span>
                </button>
            </div>
        </aside>

        <!-- Main Content Area -->
        <main class="main-content">
            <header>
                <div class="header-welcome">
                    <h1 data-i18n="header_kasir">Kasir</h1>
                    <p class="date-display" id="date-display">...</p>
                </div>
                <div class="search-bar">
                    <i class="fa-solid fa-search"></i>
                    <input type="text" id="search-input" placeholder="Cari menu favorit..."
                        data-i18n-placeholder="search_placeholder">
                </div>
            </header>

            <div class="menu-grid" id="menu-container">
                <!-- Products injected here -->
            </div>
        </main>

        <!-- Cart Section -->
        <aside id="cart-panel" class="cart-panel">
            <div class="cart-header">
                <h3 data-i18n="cart_title">Order Details</h3>
                <div style="display: flex; align-items: center; gap: 8px;">
                    <span class="order-id">#ORD-001</span>
                    <button class="close-cart-btn" onclick="toggleCart()"
                        style="display:none; background:none; border:none; font-size:1.2rem; cursor:pointer; color:var(--text-muted);">
                        <i class="fa-solid fa-times"></i>
                    </button>
                </div>
            </div>

            <div class="cart-items" id="cart-items">
                <!-- Cart items injected here -->
                <div class="empty-cart">
                    <i class="fa-solid fa-shopping-basket"></i>
                    <p data-i18n="cart_empty">Keranjang kosong</p>
                </div>
            </div>

            <div class="cart-footer">
                <div class="summary-item">
                    <span data-i18n="cart_subtotal">Subtotal</span>
                    <span id="subtotal">Rp 0</span>
                </div>
                <div class="summary-item total">
                    <span data-i18n="cart_total">Total</span>
                    <span id="total">Rp 0</span>
                </div>
                <button class="checkout-btn" id="checkout-btn" data-i18n="btn_checkout">
                    Proses Pembayaran
                </button>
            </div>
        </aside>

        <!-- FAB for Checkout on Mobile -->
        <button class="fab" id="fab-checkout">
            <i class="fa-solid fa-bolt"></i>
        </button>
    </div>

    <!-- Modals -->
    <!-- Checkout Modal -->
    <div id="checkout-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 data-i18n="modal_payment_title">Konfirmasi Pembayaran</h2>
                <span class="close-modal" onclick="closeModal()">&times;</span>
            </div>
            <div class="modal-body">
                <div class="order-summary">
                    <h3 data-i18n="modal_order_summary">Ringkasan Pesanan</h3>
                    <div id="checkout-items"></div>
                    <div class="checkout-total">
                        <span data-i18n="modal_total_bill">Total Tagihan</span>
                        <span id="modal-total"
                            style="color: var(--primary-color); font-weight: 800; font-size: 1.5rem;">Rp 0</span>
                    </div>
                </div>
                <div class="payment-methods">
                    <h3 data-i18n="modal_payment_method">Metode Pembayaran</h3>
                    <div class="method-grid">
                        <label class="method-card">
                            <input type="radio" name="payment" value="Tunai" checked>
                            <div class="method-content">
                                <i class="fa-solid fa-money-bill-wave"></i>
                                <span data-i18n="pay_cash">Tunai</span>
                            </div>
                        </label>
                        <label class="method-card">
                            <input type="radio" name="payment" value="Qris">
                            <div class="method-content">
                                <i class="fa-solid fa-qrcode"></i>
                                <span>QRIS</span>
                            </div>
                        </label>
                        <label class="method-card">
                            <input type="radio" name="payment" value="Transfer">
                            <div class="method-content">
                                <i class="fa-solid fa-bank"></i>
                                <span>Transfer</span>
                            </div>
                        </label>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="secondary-btn" onclick="closeModal()" data-i18n="btn_cancel">Batal</button>
                <button class="primary-btn" id="confirm-checkout" data-i18n="btn_confirm_pay">Konfirmasi &
                    Cetak</button>
            </div>
        </div>
    </div>

    <!-- Receipt Modal -->
    <div id="receipt-modal" class="modal receipt-modal">
        <div class="receipt-paper">
            <div id="receipt-content"></div>
            <div class="no-print" style="margin-top: 2rem; display: flex; gap: 10px;">
                <button onclick="window.print()" class="primary-btn" style="flex:1;"><i class="fa-solid fa-print"></i>
                    Cetak</button>
                <button onclick="closeReceipt()" class="secondary-btn" style="flex:1;">Tutup</button>
            </div>
        </div>
    </div>

    <!-- Admin History Modal -->
    <div id="history-modal" class="modal">
        <div class="modal-content wide">
            <div class="modal-header">
                <h2 data-i18n="modal_history_title">Riwayat Pesanan Hari Ini</h2>
                <span class="close-modal" onclick="closeHistory()">&times;</span>
            </div>
            <div class="modal-body">
                <div class="history-stats">
                    <div class="stat-card">
                        <span data-i18n="stat_income">Total Pendapatan</span>
                        <h3 id="total-income">Rp 0</h3>
                    </div>
                    <div class="stat-card">
                        <span data-i18n="stat_orders">Total Pesanan</span>
                        <h3 id="total-orders">0</h3>
                    </div>
                </div>
                <div class="history-table-container">
                    <table class="history-table">
                        <thead>
                            <tr>
                                <th data-i18n="th_time">Waktu</th>
                                <th data-i18n="th_order_id">ID Pesanan</th>
                                <th data-i18n="th_items">Menu</th>
                                <th data-i18n="th_total">Total</th>
                                <th data-i18n="th_method">Metode</th>
                                <th data-i18n="th_cashier">Kasir</th>
                                <th data-i18n="th_action">Aksi</th>
                            </tr>
                        </thead>
                        <tbody id="history-body"></tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- Add/Edit Menu Modal -->
    <div id="menu-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="menu-modal-title" data-i18n="modal_add_menu">Tambah Menu Baru</h2>
                <span class="close-modal" onclick="closeMenuModal()">&times;</span>
            </div>
            <div class="modal-body">
                <form id="menu-form">
                    <input type="hidden" id="menu-id">
                    <div class="form-group">
                        <label data-i18n="label_name">Nama Menu</label>
                        <input type="text" id="menu-name" required>
                    </div>
                    <div class="form-group">
                        <label data-i18n="label_price">Harga (Rp)</label>
                        <input type="number" id="menu-price" required>
                    </div>
                    <div class="form-group">
                        <label data-i18n="label_category">Kategori</label>
                        <select id="menu-category" required>
                            <option value="signature">Signature</option>
                            <option value="coffee">Coffee</option>
                            <option value="non-coffee">Non-Coffee</option>
                            <option value="tea">Tea Series</option>
                            <option value="snack">Snack</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Icon</label>
                        <select id="menu-icon">
                            <option value="fa-mug-hot">Coffee Cup</option>
                            <option value="fa-glass-water">Glass</option>
                            <option value="fa-leaf">Leaf (Tea)</option>
                            <option value="fa-burger">Burger/Snack</option>
                            <option value="fa-ice-cream">Ice Cream</option>
                            <option value="fa-star">Star</option>
                        </select>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="secondary-btn" onclick="closeMenuModal()" data-i18n="btn_cancel">Batal</button>
                <button class="primary-btn" id="save-menu-btn" data-i18n="btn_save">Simpan</button>
            </div>
        </div>
    </div>

    <!-- Split Bill Modal -->
    <div id="split-bill-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Split Bill</h2>
                <span class="close-modal" onclick="closeSplitBillModal()">&times;</span>
            </div>
            <div class="modal-body">
                <p data-i18n="split_bill_desc">Centang item yang ingin dibayar sekarang:</p>
                <div id="split-bill-items"></div>
                <div class="checkout-total">
                    <span data-i18n="modal_total_bill">Total Tagihan</span>
                    <span id="split-bill-total-display"
                        style="color: var(--primary-color); font-weight: 800; font-size: 1.5rem;">Rp 0</span>
                </div>
            </div>
            <div class="modal-footer">
                <button class="secondary-btn" onclick="closeSplitBillModal()">Batal</button>
                <button class="primary-btn" id="confirm-split-checkout">Proses Item Terpilih</button>
            </div>
        </div>
    </div>

    <!-- Payment Update Modal -->
    <div id="payment-update-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Ubah Metode Pembayaran</h2>
                <span class="close-modal" onclick="closePaymentUpdateModal()">&times;</span>
            </div>
            <div class="modal-body">
                <p>Ubah metode pembayaran untuk pesanan ini:</p>
                <div class="method-grid">
                    <label class="method-card">
                        <input type="radio" name="update-payment" value="Tunai">
                        <div class="method-content">
                            <i class="fa-solid fa-money-bill-wave"></i>
                            <span>Tunai</span>
                        </div>
                    </label>
                    <label class="method-card">
                        <input type="radio" name="update-payment" value="Qris">
                        <div class="method-content">
                            <i class="fa-solid fa-qrcode"></i>
                            <span>QRIS</span>
                        </div>
                    </label>
                    <label class="method-card">
                        <input type="radio" name="update-payment" value="Transfer">
                        <div class="method-content">
                            <i class="fa-solid fa-bank"></i>
                            <span>Transfer</span>
                        </div>
                    </label>
                </div>
            </div>
            <div class="modal-footer">
                <button class="secondary-btn" onclick="closePaymentUpdateModal()">Batal</button>
                <button class="primary-btn" id="confirm-payment-update-btn">Simpan Perubahan</button>
            </div>
        </div>
    </div>

    <!-- Add scripts at the end -->
    <script src="./script.js?v=1.2"></script>
</body>

</html>
